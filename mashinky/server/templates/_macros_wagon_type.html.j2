{% macro empty(title) -%}
  <span class="text-faded" title="{{ title }}">&mdash;</span>
{%- endmacro %}

{% macro id(wagon_type) -%}
  <small class="font-monospace text-muted">{{ wagon_type.id }}</small>
{%- endmacro %}

{% macro type(wagon_type) -%}
  <small class="font-monospace text-muted">{{ wagon_type.__class__.__name__ }}</small>
{%- endmacro %}

{% macro name(wagon_type) -%}
  {% if wagon_type.type == "engine" %}
    {% set class="text-royal-blue" %}
  {% elif wagon_type.type == "wagon" %}
    {% set class="text-sage-green" %}
  {% elif wagon_type.type == "road_vehicle" %}
    {% set class="text-chocolate" %}
  {% endif %}
  <span class="{{ class }}">{{ wagon_type.name }}</span>
  {% if wagon_type.is_quest_reward %}
    <span title="Quest Reward">â˜…</span>
  {% endif %}
{%- endmacro %}

{% macro icon(wagon_type, tile_width) -%}
  <img src="{{ url_for('static', filename=wagon_type.icon) }}" alt="{{ wagon_type.name }}" title="{{ wagon_type.name }} [{{ wagon_type.id }}]" width="{{ tile_width * wagon_type.length }}px">
{%- endmacro %}

{% macro icon_single(wagon_type, tile_width) -%}
  <div class="app-tiles" style="width: {{ tile_width * 2 }}px;">
    {{ icon(wagon_type, tile_width) }}
  </div>
{%- endmacro %}

{% macro icon_train(train, tile_width) %}
  <div class="app-tiles" style="width: {{ (tile_width * train.station_length) + 1 }}px;">
    {%- for wagon_type in train -%}
      {{- icon(wagon_type, tile_width) -}}
    {%- endfor -%}
  </div>
{% endmacro %}

{% macro epoch(wagon_type) -%}
  {%- if wagon_type.epoch_start and wagon_type.epoch_end -%}
    <span title="{{ wagon_type.epoch_start }} to {{ wagon_type.epoch_end|lower }}">{{ wagon_type.epoch_start.numeral }}&ndash;{{ wagon_type.epoch_end.numeral }}</span>
  {%- elif wagon_type.epoch_start -%}
    <span title="{{ wagon_type.epoch_start }} onwards">{{ wagon_type.epoch_start.numeral }}</span>
  {%- else -%}
    {{ empty("Quest reward") }}
  {%- endif -%}
{%- endmacro %}

{% macro track(wagon_type) -%}
  {% if wagon_type.track.value == 0 %}
    {{ empty("Standard track") }}
  {% else %}
    <span>{{ wagon_type.track }}</span>
  {% endif %}
{%- endmacro %}

{% macro weight(wagon_type) -%}
  {% if wagon_type.weight_empty != wagon_type.weight_full %}
    <span class="text-truncate">{{ wagon_type.weight_empty }}&ndash;{{ wagon_type.weight_full }} tons</span>
  {% else %}
    <span class="text-truncate">{{ wagon_type.weight_empty }} tons</span>
  {% endif %}

{%- endmacro %}

{% macro recommended_weight(wagon_type) -%}
  <span class="text-truncate">{{ wagon_type.recommended_weight }} tons</span>
{%- endmacro %}

{% macro length(wagon_type) -%}
  <span class="text-truncate">{{ "%.2f"|format(wagon_type.length) }} tiles</span>
{%- endmacro %}

{% macro costs(payments) -%}
  {% for payment in payments %}
    <div class="d-inline-flex justify-content-start align-items-center">
      <img class="d-block mx-1 app-icon-sm" src="{{ url_for('static', filename=payment.token_type.icon) }}" alt="{{ payment.token_type }}">
      <span class="d-block">{{ payment.amount }}</span>
    </div>
  {% endfor %}
{%- endmacro %}

{% macro depo_upgrade(wagon_type) -%}
  <span>{{ 'Yes' if wagon_type.depo_upgrade else 'No' }}</span>
{%- endmacro %}

{# Engines #}

{% macro power(engine) -%}
  <span>{{ engine.power }} hp</span>
{%- endmacro %}

{% macro speed(engine) -%}
  <span>{{ engine.max_speed }} km/h</span>
{%- endmacro %}

{# This isn't actually used, all trains reverse at 19mph. #}
{% macro reverse_speed(engine) -%}
  {% if engine.max_speed_reverse is not none -%}
    <span class="text-faded">({{ engine.max_speed_reverse }} km/h)</span>
  {%- endif %}
{%- endmacro %}

{# Wagons and road vehicles #}

{% macro cargo(wagon_type) -%}
  {%- for cargo_type in wagon_type.cargo_types -%}
    <div class="d-inline-flex justify-content-start align-items-center">
      <img class="d-block mx-1 app-icon-sm" src="{{ url_for('static', filename=cargo_type.icon) }}" alt="{{ cargo_type }}">
      <span class="d-block">{{ wagon_type.capacity }}</span>
    </div>
  {%- else -%}
    {{ empty("No cargo") }}
  {%- endfor -%}
{%- endmacro %}

{# Trains #}

{% macro description(train) %}
  {% for wagon_type, count in train.counter.items() %}
    <span class="app-train-description">
      {{ name(wagon_type) }}
      {%- if count > 1 -%}
        <span> x{{ count }}</span>
      {%- endif -%}
      {%- if not loop.last -%}
        <span>, </span>
      {%- endif -%}
    </span>
  {% endfor %}
{% endmacro %}

{% macro warnings(train) %}
  {% if train.is_overweight_empty %}
    <span class="badge bg-red" title="Train is overweight when empty.{{ line_break }}It may slow down and struggle to go uphill.{{ line_break }}Recommended weight: {{ train.recommended_weight }} tons.">Overweight</span>
  {% elif train.is_overweight_full %}
    <span class="badge bg-peach" title="Train is overweight when full.{{ line_break }}It may slow down and struggle to go uphill.{{ line_break }}Recommended weight: {{ train.recommended_weight }} tons.">Overweight</span>
  {% endif %}

  {% if train.is_overlong %}
    <span class="badge bg-chocolate" title="Train is longer than the configured station length ({{ train.station_length }} tiles).{{ line_break }}It will take longer to load and unload cargo.">Overlong</span>
  {% endif %}
{% endmacro %}

{% macro limits(train) %}
  {% if train.limited_by_length %}
    <span class="app-limit-length badge">Station length</span>
  {% endif %}

  {% if train.limited_by_weight %}
    <span class="app-limit-weight badge">Recommended weight</span>
  {% endif %}

  {% if not train.limited_by_length and not train.limited_by_weight %}
    {{ empty("Not limited by length or weight") }}
  {% endif %}
{% endmacro %}
